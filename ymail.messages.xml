<?xml version="1.0" encoding="UTF-8"?>
<i:table xmlns:i="http://query.yahooapis.com/v1/schema/internalTable.xsd" xmlns="http://query.yahooapis.com/v1/schema/table.xsd" securityLevel="user">
  <meta>
    <author>Yahoo! Inc.</author>
    <sampleQuery>select * from {table}</sampleQuery>
  </meta>
  <i:bindings>
   <i:select itemPath="json.result" produces="JSON" auth="yahooOauth">
      <urls>
        <url>http://mail.yahooapis.com/ws/mail/v1.1/jsonrpc</url>
      </urls>
      <inputs>
	  	    <key id="query" type='xs:string' paramType='variable' />
		    <key id="from" type='xs:string' paramType='variable' />
	   	    <key id="to" type='xs:string' paramType='variable' />
	 	    <key id="subject" type='xs:string' paramType='variable'/>
		    <key id="cc" type='xs:string' paramType='variable' />
	  	    <key id="bcc" type='xs:string' paramType='variable' />
		    <key id="flags" type='xs:string' paramType='variable' />
		    <key id="attachment" type='xs:string' paramType='variable' />
		    <key id="attachmentcount" type='xs:string' paramType='variable' />
		    <key id="attachmenttype" type='xs:string' paramType='variable' />
		    <key id="attachmentname" type='xs:string' paramType='variable' />
		    <key id="attachmentlanguages" type='xs:string' paramType='variable' />
		  <!--  <key id="searchtype" type='xs:string' paramType='variable' default='whole' /> -->
		    <key id="startMid" type='xs:string' paramType='variable' default='0' />
		    <key id="numMid" type='xs:string' paramType='variable' default='50' />
		    <key id="startInfo" type='xs:string' paramType='variable' default='0' />
		    <key id="numInfo" type='xs:string' paramType='variable' default='50' />
		    <key id="fid" type='xs:string' paramType='variable' default='Inbox'/>
		    <key id="mid" type='xs:string' paramType='variable' />
		    <key id="pid" type='xs:string' paramType='variable' />
		    <key id="search" type='xs:string' paramType='variable' />
			<key id="groupBy" type='xs:string' paramType='variable' default='unRead' />
		    <key id="sortKey" type='xs:string' paramType='variable' default='date' />
		    <key id="sortOrder" type='xs:string' paramType='variable' default='up' />
	  </inputs>
	  <execute><![CDATA[
		
		y.include("http://github.com/ramiyer/ymailtables/raw/master/messages.js");
		y.include("http://github.com/ramiyer/ymailtables/raw/master/json2.js");
	
        //Intialization
        var content = '';
        var params = '[{}]';
		var fid = escape(inputs["fid"]);
		
		//Initialize Array which holds all the search params
		var searchParamsInQuery = {'query','from','to','subject','cc','bcc','flags','attachment','attachmentcount','attachmentname','attachmentlanguages','attachmenttype'};
		var checkForSearchParams = false;
		
		//check if any req in query has any value in searchParamsInQuery [inputs !== searchParamsInQuery] and set the flag to true
		
		y.log("inputs and searchParamsInQuery to String");
		y.log(inputs);
		y.log(searchParamsInQuery.toString());
		
	   	for(var propertyName in inputs) {
	   		if(inputs[propertyName] == searchParamsInQuery[propertyName]) {
		         checkForSearchParams = true;
		         break;
		    }
	    }

		
		y.log(inputs.query)
		
		
		if (checkForSearchParams == true){
			content = searchMessagesReq();
		}else {
			content = listMessagesReq();
		}
       	
		//content = JSON.stringify(content);
		y.log("content is ");
		y.log(content);
		
		var returned_response = request.post(content).response;
		y.log(returned_response);
		
		response.object = returned_response;

      ]]></execute>
   </i:select>
  </i:bindings>
</i:table>
